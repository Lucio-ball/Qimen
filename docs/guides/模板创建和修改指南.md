# 奇门遁甲模板创建和修改指南

## 问题解决

✅ **修复完成**: 模板参数未找到的问题已经解决！

原因是模板文件中使用的参数值与实际排盘数据格式不匹配。现在已经更新为正确的格式。

## 模板文件位置

模板文件位于: `data/templates.json`

## 模板文件格式

模板文件使用JSON格式，结构如下：

```json
{
  "模板名称": [
    {
      "param_type": "参数类型",
      "param_value": "参数值",
      "label": "标注文本"
    }
  ]
}
```

## 支持的参数类型

### 1. riGan - 日干
- **说明**: 根据四柱日干自动查找对应的天盘干
- **param_value**: 设置为 `null`（系统自动匹配）
- **示例**:
```json
{
  "param_type": "riGan",
  "param_value": null,
  "label": "日干(求测人)"
}
```

### 2. zhiFu - 值符
- **说明**: 查找值符所在位置的九星
- **param_value**: 设置为 `null`（系统自动匹配）
- **示例**:
```json
{
  "param_type": "zhiFu",
  "param_value": null,
  "label": "值符(领导)"
}
```

### 3. zhiShi - 值使
- **说明**: 查找值使所在位置的八门
- **param_value**: 设置为 `null`（系统自动匹配）
- **示例**:
```json
{
  "param_type": "zhiShi",
  "param_value": null,
  "label": "值使(治疗)"
}
```

### 4. tianGan - 天干
- **说明**: 查找指定的天盘干
- **可用值**: `甲`, `乙`, `丙`, `丁`, `戊`, `己`, `庚`, `辛`, `壬`, `癸`
- **示例**:
```json
{
  "param_type": "tianGan",
  "param_value": "乙",
  "label": "乙奇(女性)"
}
```

### 5. jiuXing - 九星
- **说明**: 查找指定的九星
- **可用值**: `蓬`, `任`, `冲`, `辅`, `禽`, `心`, `柱`, `芮`, `英`
- **示例**:
```json
{
  "param_type": "jiuXing",
  "param_value": "芮",
  "label": "天芮(疾病)"
}
```

### 6. baMen - 八门
- **说明**: 查找指定的八门
- **可用值**: `休`, `死`, `伤`, `杜`, `开`, `惊`, `生`, `景`
- **示例**:
```json
{
  "param_type": "baMen",
  "param_value": "休",
  "label": "休门(婚姻)"
}
```

### 7. baShen - 八神
- **说明**: 查找指定的八神
- **可用值**: `符`, `蛇`, `阴`, `合`, `虎`, `武`, `地`, `天`
- **示例**:
```json
{
  "param_type": "baShen",
  "param_value": "合",
  "label": "六合(婚配)"
}
```

## 如何添加新模板

### 步骤1: 编辑模板文件
用任何文本编辑器打开 `data/templates.json`

### 步骤2: 添加新模板
在文件末尾添加新的模板，注意JSON格式：

```json
{
  "现有模板1": [...],
  "现有模板2": [...],
  "您的新模板名称": [
    {
      "param_type": "riGan",
      "param_value": null,
      "label": "日干(求测人)"
    },
    {
      "param_type": "jiuXing",
      "param_value": "心",
      "label": "天心(医生)"
    },
    {
      "param_type": "baMen",
      "param_value": "生",
      "label": "生门(财运)"
    }
  ]
}
```

### 步骤3: 保存并重启应用
保存文件后重新启动应用程序，新模板将自动出现在下拉列表中。

## 如何修改现有模板

### 修改模板名称
将模板的键名更改为新的名称：
```json
"新的模板名称": [原来的参数列表]
```

### 添加参数
在参数数组中添加新的参数对象：
```json
{
  "param_type": "tianGan",
  "param_value": "戊",
  "label": "戊土(财星)"
}
```

### 删除参数
从参数数组中删除不需要的参数对象。

### 修改标注文本
更改参数的 `label` 值：
```json
{
  "param_type": "jiuXing",
  "param_value": "芮",
  "label": "天芮(疾病根源)"  // 修改了标注文本
}
```

## 示例：创建一个"求子测孕"模板

```json
"求子测孕": [
  {
    "param_type": "riGan",
    "param_value": null,
    "label": "日干(求测人)"
  },
  {
    "param_type": "tianGan",
    "param_value": "丁",
    "label": "丁火(子女)"
  },
  {
    "param_type": "jiuXing",
    "param_value": "芮",
    "label": "天芮(母体)"
  },
  {
    "param_type": "baMen",
    "param_value": "生",
    "label": "生门(生育)"
  },
  {
    "param_type": "baShen",
    "param_value": "合",
    "label": "六合(和谐)"
  }
]
```

## 注意事项

1. **JSON格式**: 确保文件符合JSON格式要求，注意逗号和引号
2. **参数值大小写**: 参数值必须与排盘数据完全匹配，区分大小写
3. **中文字符**: 使用简化的中文字符（如"芮"而不是"天芮"）
4. **文件编码**: 保存为UTF-8编码
5. **备份**: 修改前建议备份原文件

## 调试工具

如果遇到参数不匹配的问题，可以运行调试脚本：
```bash
python debug_template_matching.py
```

这个脚本会显示实际的排盘数据格式，帮助您创建正确的模板。

## 常见错误

### 1. JSON格式错误
**错误**: 缺少逗号或引号
**解决**: 使用JSON格式验证工具检查文件格式

### 2. 参数值不匹配
**错误**: 使用了错误的参数值（如"tianRui"而不是"芮"）
**解决**: 参考本指南中的可用值列表

### 3. 参数类型不支持
**错误**: 使用了不支持的参数类型
**解决**: 只使用本指南中列出的7种参数类型

## 扩展功能

未来可能添加的功能：
- 可视化模板编辑器
- 模板导入导出功能
- 模板验证工具
- 在线模板库
